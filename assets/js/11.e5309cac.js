(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{270:function(t,a,s){"use strict";s.r(a);var e=s(38),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"postgresql-arrays-and-waterline"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postgresql-arrays-and-waterline","aria-hidden":"true"}},[t._v("#")]),t._v(" PostgreSQL Arrays and Waterline")]),t._v(" "),s("p",[t._v("Fancy storing arrays in your PostreSQL database using Sails.js and Waterline?")]),t._v(" "),s("p",[t._v("Using the native support for arrays in Postgres is basically as easy as manually specifying a "),s("code",[t._v("columnType")]),t._v(" in your model attributes.")]),t._v(" "),s("h3",{attrs:{id:"defining-array-type-model-attributes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defining-array-type-model-attributes","aria-hidden":"true"}},[t._v("#")]),t._v(" Defining Array-Type Model Attributes")]),t._v(" "),s("p",[t._v("Below is an example of a Waterline attribute containing an array of strings:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v(" favouriteFruits"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ref'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  columnType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text[]'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  description"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("An array of a user's favourite fruits")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("And it's really as simple as that. Now throughout your Sails application you're able to do things that should feel quite natural as a JS developer.")]),t._v(" "),s("p",[t._v("You might also want to check out the "),s("a",{attrs:{href:"https://www.postgresql.org/docs/10/arrays.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL Arrays documentation"),s("OutboundLink")],1),t._v("\nfor a better understanding of the different column types available and other low-level usage examples.")]),t._v(" "),s("h3",{attrs:{id:"creating-editing-records-with-array-columns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#creating-editing-records-with-array-columns","aria-hidden":"true"}},[t._v("#")]),t._v(" Creating/Editing Records with Array Columns")]),t._v(" "),s("p",[t._v("You're able to use the regular "),s("a",{attrs:{href:"https://sailsjs.com/documentation/reference/waterline-orm/models/create",target:"_blank",rel:"noopener noreferrer"}},[t._v("create"),s("OutboundLink")],1),t._v("/"),s("a",{attrs:{href:"https://sailsjs.com/documentation/reference/waterline-orm/models/update",target:"_blank",rel:"noopener noreferrer"}},[t._v("update"),s("OutboundLink")],1),t._v(" methods passing an array as an attribute's value.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newFruitLover "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bob'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  favouriteFruits"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'apple'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'orange'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"searching-array-columns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#searching-array-columns","aria-hidden":"true"}},[t._v("#")]),t._v(" Searching Array Columns")]),t._v(" "),s("p",[t._v("For searching on an "),s("em",[s("strong",[t._v("exact match")])]),t._v(" of an array, you can use the usual query methods.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" results "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" favouriteFruits"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'apple'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'orange'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Unfortunately, searching for records that "),s("em",[t._v("contain")]),t._v(" a single/several items in an array column but which could contain others is a little messy.\nIt's at this point we may need to bust out some "),s("a",{attrs:{href:"https://sailsjs.com/documentation/reference/waterline-orm/datastores/send-native-query",target:"_blank",rel:"noopener noreferrer"}},[t._v("raw SQL"),s("OutboundLink")],1),t._v(" and kick it old-school.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FRUIT_LOVERS_QUERY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('SELECT * FROM "people" WHERE "favouriteFruits" @> $1')]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" appleLovers "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" sails"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendNativeQuery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FRUIT_LOVERS_QUERY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'apple'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Any returned records should be found in")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   appleLovers.rows")]),t._v("\n")])])]),s("p",[t._v("The "),s("code",[t._v("@>")]),t._v(' in the above query is Postgres\' "contains" query operator. A list of other native Postgres array functions/operators are available '),s("a",{attrs:{href:"https://www.postgresql.org/docs/10/functions-array.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1),t._v(".")])])},[],!1,null,null,null);a.default=n.exports}}]);