<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying Sails.js with nginx | Sails Guide</title>
    <meta name="description" content="Helping you to navigate the 7 seas">
    
    
    <link rel="preload" href="/assets/css/0.styles.8c309c23.css" as="style"><link rel="preload" href="/assets/js/app.03438862.js" as="script"><link rel="preload" href="/assets/js/3.6df9ed4a.js" as="script"><link rel="preload" href="/assets/js/1.ddb0221a.js" as="script"><link rel="preload" href="/assets/js/15.07bf4797.js" as="script"><link rel="preload" href="/assets/js/6.4f58f17a.js" as="script"><link rel="prefetch" href="/assets/js/10.3bebca11.js"><link rel="prefetch" href="/assets/js/11.d66ddca6.js"><link rel="prefetch" href="/assets/js/12.bc8e79f7.js"><link rel="prefetch" href="/assets/js/13.354c0541.js"><link rel="prefetch" href="/assets/js/14.a0f85895.js"><link rel="prefetch" href="/assets/js/16.40a79d3a.js"><link rel="prefetch" href="/assets/js/17.ef25d2dd.js"><link rel="prefetch" href="/assets/js/18.66b27ce5.js"><link rel="prefetch" href="/assets/js/19.de18e3c5.js"><link rel="prefetch" href="/assets/js/4.2cfb12a5.js"><link rel="prefetch" href="/assets/js/5.266e0cb9.js"><link rel="prefetch" href="/assets/js/7.5296c7ff.js"><link rel="prefetch" href="/assets/js/8.7e6c4992.js"><link rel="prefetch" href="/assets/js/9.9778ef37.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8c309c23.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/captain.svg" alt="Sails Guide" class="logo"> <span class="site-name can-hide">Sails Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <a href="https://github.com/sails-guide/source" target="_blank" rel="noopener noreferrer" class="repo-link">
    Wanna help?
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <a href="https://github.com/sails-guide/source" target="_blank" rel="noopener noreferrer" class="repo-link">
    Wanna help?
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Databases &amp; ORM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/deployment/" class="sidebar-link">Before you deploy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deployment/#put-your-head-between-your-legs" class="sidebar-link">Put your head between your legs</a></li><li class="sidebar-sub-header"><a href="/deployment/#brace-yourself" class="sidebar-link">Brace yourself</a></li><li class="sidebar-sub-header"><a href="/deployment/#kiss-your-ass-goodbye" class="sidebar-link">Kiss your ass goodbye</a></li></ul></li><li><a href="/deployment/nginx.html" class="active sidebar-link">Deploying Sails.js with nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deployment/nginx.html#application-requirements" class="sidebar-link">Application Requirements</a></li><li class="sidebar-sub-header"><a href="/deployment/nginx.html#installing-nginx" class="sidebar-link">Installing nginx</a></li><li class="sidebar-sub-header"><a href="/deployment/nginx.html#proxying-nginx-requests-to-our-application" class="sidebar-link">Proxying nginx requests to our application</a></li><li class="sidebar-sub-header"><a href="/deployment/nginx.html#serving-static-files-with-nginx" class="sidebar-link">Serving static files with nginx</a></li><li class="sidebar-sub-header"><a href="/deployment/nginx.html#file-caching" class="sidebar-link">File Caching</a></li><li class="sidebar-sub-header"><a href="/deployment/nginx.html#configuring-ssl" class="sidebar-link">Configuring SSL</a></li><li class="sidebar-sub-header"><a href="/deployment/nginx.html#all-together-now" class="sidebar-link">All together now</a></li></ul></li></ul></section></li><li><a href="/faq.html" class="sidebar-link">FAQ</a></li><li><a href="https://sailsjs.com/documentation" target="_blank" rel="noopener noreferrer" class="sidebar-link">Offical Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://gitter.im/balderdashy/sails" target="_blank" rel="noopener noreferrer" class="sidebar-link">Gitter Chat<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deploying-sails-js-with-nginx"><a href="#deploying-sails-js-with-nginx" aria-hidden="true" class="header-anchor">#</a> Deploying Sails.js with nginx</h1> <p>Nginx is a powerful and lightweight HTTP server that we use to proxy between
the internet and our Sails application. By serving our web traffic with nginx we will be able to load-balance our web
traffic between multiple application servers, host several domains or SSL certificates on the same IP address, set up L4 rate-limiting and access controls and much more.</p> <div preset="vue" class="vuepress_plugin__mermaid__wrapper"></div><h2 id="application-requirements"><a href="#application-requirements" aria-hidden="true" class="header-anchor">#</a> Application Requirements</h2> <p>In order for client IP addresses to be accessible in Sails, you'll need to set <a href="https://sailsjs.com/documentation/reference/configuration/sails-config-http" target="_blank" rel="noopener noreferrer"><code>sails.config.http.trustProxy</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to <code>true</code>. This guide also assumes that you have already configured your Sails application to run as a long-lived service.</p> <h2 id="installing-nginx"><a href="#installing-nginx" aria-hidden="true" class="header-anchor">#</a> Installing nginx</h2> <p>You may need to first install nginx if it's not already.
The following commands should be enough to get you started quickly.</p> <p>If you want to make sure you're running the latest version
or to create a custom build of nginx you should check out the official <a href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/" target="_blank" rel="noopener noreferrer">nginx installation docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
as OS distributions can often include old versions in their software repositories.</p> <div class="el-tabs el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nginx
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> nginx
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><p>Assuming you have <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">homebrew<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> installed, simply run:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>brew <span class="token function">install</span> nginx
</code></pre></div></div></div></div> <h2 id="proxying-nginx-requests-to-our-application"><a href="#proxying-nginx-requests-to-our-application" aria-hidden="true" class="header-anchor">#</a> Proxying nginx requests to our application</h2> <p>We'll need to add a configuration file to tell nginx how and where to send requests to our Sails.js application.</p> <div class="el-tabs el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="tip custom-block"><p>If you're using Ubuntu/Debian, this configuration file will need to be placed in the <code>***/etc/nginx/sites-enabled***</code> directory</p></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="tip custom-block"><p>If you're using CentOS/RHEL, this configuration file will need to be placed in the <code>***/etc/nginx/sites-enabled***</code> directory</p></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="tip custom-block"><p>If you're using OSX, this configuration file will need to be placed in the <code>***/etc/nginx/sites-enabled***</code> directory</p></div></div></div></div> <p>The following nginx configuration file contains the <a href="https://www.youtube.com/watch?v=9ogQ0uge06o" target="_blank" rel="noopener noreferrer">bare necessities<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> required to get nginx to proxy HTTP and WebSocket requests to our Sails.js application. It assumes that nginx and your Sails app are running on the same machine, and Sails is accepting requests on port <code>1337</code>.</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> <span class="token keyword">upstream</span><span class="token operator">-</span>kittehblr <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">1337</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># This will proxy all HTTP and WebSocket requests to our Sails application defined above</span>
<span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span> kittehblr<span class="token punctuation">.</span>com www<span class="token punctuation">.</span>kittehblr<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token comment"># Send all requests to our Sails Application</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token keyword">upstream</span><span class="token operator">-</span>kittehblr<span class="token punctuation">;</span>

    <span class="token comment"># Proxy headers required for WebSocket connections</span>
    <span class="token keyword">proxy_redirect</span>     off<span class="token punctuation">;</span>
    <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span><span class="token punctuation">;</span>

    <span class="token comment"># Pass the client IP and requested Host (ie, kittehblr.com) to Sails as request headers</span>
    <span class="token keyword">proxy_set_header</span>   Host             <span class="token variable">$host</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span>   X<span class="token operator">-</span>Real<span class="token operator">-</span>IP        <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span>   X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For  <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The <code>upstream</code> block tells nginx where to find our application. For now we have just the one server (<code>127.0.0.1</code>), but in the future you could easily have nginx <a href="https://dnsdetective.net/articles/networking/http-load-balancing-with-nginx" target="_blank" rel="noopener noreferrer">load balance requests between multiple servers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to handle increased load. Just add another <code>server</code> line and <code>sudo service nginx reload</code> to tell nginx about the configuration change.</p> <p>The <a href="https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/" target="_blank" rel="noopener noreferrer"><code>server</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> block defines our public facing proxy settings. Namely that we want to serve traffic for <code>kittehblr.com</code> and <code>www.kittehblr.com</code> on port <code>80</code> (&quot;regular&quot; HTTP port).</p> <p>The <code>location /</code> block passes <em><strong>all</strong></em> requests to our Sails application.</p> <h2 id="serving-static-files-with-nginx"><a href="#serving-static-files-with-nginx" aria-hidden="true" class="header-anchor">#</a> Serving static files with nginx</h2> <div class="language- extra-class"><pre class="language-text"><code>[ request ] --&gt; [ nginx ] --&gt; [ Sails.js App ]
</code></pre></div><p>nginx is likely to be able to serve static assets (your CSS, images, frontend JavaScript, etc) more efficiently than your node application,</p> <h2 id="file-caching"><a href="#file-caching" aria-hidden="true" class="header-anchor">#</a> File Caching</h2> <h2 id="configuring-ssl"><a href="#configuring-ssl" aria-hidden="true" class="header-anchor">#</a> Configuring SSL</h2> <h2 id="all-together-now"><a href="#all-together-now" aria-hidden="true" class="header-anchor">#</a> All together now</h2> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> <span class="token keyword">upstream</span><span class="token operator">-</span>kittehblr <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">1337</span><span class="token punctuation">;</span>
    <span class="token comment"># We could add multiple servers here, if we had them</span>
    <span class="token comment"># 10.0.0.2:1337;</span>
    <span class="token comment"># 10.0.0.3:1337;</span>
<span class="token punctuation">}</span>

<span class="token keyword">map</span> <span class="token variable">$sent_http_content_type</span> <span class="token variable">$expires_kittehblr</span> <span class="token punctuation">{</span>
    default                    off<span class="token punctuation">;</span>
    text<span class="token operator">/</span>html                  epoch<span class="token punctuation">;</span>
    text<span class="token operator">/</span>css                   max<span class="token punctuation">;</span>
    application<span class="token operator">/</span>javascript     max<span class="token punctuation">;</span>
    <span class="token operator">~</span>image<span class="token operator">/</span>                    <span class="token number">168</span>h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span> kittehblr<span class="token punctuation">.</span>com www<span class="token punctuation">.</span>kittehblr<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

  <span class="token keyword">access_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>kittehblr<span class="token punctuation">.</span>com<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
  <span class="token keyword">error_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>kittehblr<span class="token punctuation">.</span>com<span class="token punctuation">.</span>error<span class="token punctuation">.</span>log error<span class="token punctuation">;</span>

  <span class="token keyword">root</span> <span class="token operator">/</span>opt<span class="token operator">/</span>kittehblr<span class="token punctuation">;</span>

  <span class="token keyword">client_max_body_size</span> <span class="token number">12</span>M<span class="token punctuation">;</span>
  <span class="token keyword">expires</span> <span class="token variable">$expires_kittehblr</span><span class="token punctuation">;</span>

  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token comment"># Pass off API and socket requests to the app server</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token keyword">upstream</span><span class="token operator">-</span>kittehblr<span class="token punctuation">;</span>
    <span class="token keyword">proxy_redirect</span>     off<span class="token punctuation">;</span>
    <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">proxy_set_header</span>   Host             <span class="token variable">$host</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span>   X<span class="token operator">-</span>Real<span class="token operator">-</span>IP        <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span>   X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For  <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/sails-guide/source/edit/master/content/deployment/nginx.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/deployment/" class="prev router-link-active">
          Before you deploy
        </a></span> <span class="next"><a href="/faq.html">
          FAQ
        </a>
        →
      </span></p></div> <div class="page-comments"><script src="https://utteranc.es/client.js" repo="sails-guide/comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="async"></script></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.03438862.js" defer></script><script src="/assets/js/3.6df9ed4a.js" defer></script><script src="/assets/js/1.ddb0221a.js" defer></script><script src="/assets/js/15.07bf4797.js" defer></script><script src="/assets/js/6.4f58f17a.js" defer></script>
  </body>
</html>
